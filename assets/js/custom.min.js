$(document).ready(function(){"use strict";var e=$("body");$(function(){$(".preloader").fadeOut(),$("#side-menu").metisMenu()}),$(".right-side-toggle").on("click",function(){$(".right-sidebar").slideDown(50).toggleClass("shw-rside"),$(".fxhdr").on("click",function(){e.toggleClass("fix-header")}),$(".fxsdr").on("click",function(){e.toggleClass("fix-sidebar")});var i=$(".fxhdr");e.hasClass("fix-header")?i.attr("checked",!0):i.attr("checked",!1),e.hasClass("fix-sidebar")?i.attr("checked",!0):i.attr("checked",!1)}),$(function(){var i=function(){var i=60,s=window.innerWidth>0?window.innerWidth:this.screen.width,l=(window.innerHeight>0?window.innerHeight:this.screen.height)-1;768>s?($("div.navbar-collapse").addClass("collapse"),i=100):$("div.navbar-collapse").removeClass("collapse"),1170>s?(e.addClass("content-wrapper"),$(".open-close i").removeClass("icon-arrow-left-circle"),$(".sidebar-nav, .slimScrollDiv").css("overflow-x","visible").parent().css("overflow","visible"),$(".logo span").hide()):(e.removeClass("content-wrapper"),$(".open-close i").addClass("icon-arrow-left-circle"),$(".logo span").show()),l-=i,1>l&&(l=1),l>i&&$("#page-wrapper").css("min-height",l+"px")},s=window.location,l=$("ul.nav a").filter(function(){return this.href===s||0===s.href.indexOf(this.href)}).addClass("active").parent().parent().addClass("in").parent();l.is("li")&&l.addClass("active"),$(window).ready(i),$(window).on("resize",i)}),$(".open-close").on("click",function(){$("body").hasClass("content-wrapper")?($("body").trigger("resize"),$(".sidebar-nav, .slimScrollDiv").css("overflow","hidden").parent().css("overflow","visible"),$("body").removeClass("content-wrapper"),$(".open-close i").addClass("icon-arrow-left-circle"),$(".logo span").show()):($("body").trigger("resize"),$(".sidebar-nav, .slimScrollDiv").css("overflow-x","visible").parent().css("overflow","visible"),$("body").addClass("content-wrapper"),$(".open-close i").removeClass("icon-arrow-left-circle"),$(".logo span").hide())}),function(e,i,s){var l='[data-perform="panel-collapse"]',o='[data-perform="panel-dismiss"]';e(l).each(function(){var i={toggle:!1},s=e(this).closest(".panel"),l=s.find(".panel-wrapper"),o=e(this).children("i");l.length||(l=s.children(".panel-heading").nextAll().wrapAll("<div/>").parent().addClass("panel-wrapper"),i={}),l.collapse(i).on("hide.bs.collapse",function(){o.removeClass("ti-minus").addClass("ti-plus")}).on("show.bs.collapse",function(){o.removeClass("ti-plus").addClass("ti-minus")})}),e(s).on("click",l,function(i){i.preventDefault();var s=e(this).closest(".panel"),l=s.find(".panel-wrapper");l.collapse("toggle")}),e(s).on("click",o,function(i){function l(){var i=s.parent();s.remove(),i.filter(function(){return e(this).is('[class*="col-"]')&&0===e(this).children("*").length}).remove()}i.preventDefault();var s=e(this).closest(".panel");l()})}(jQuery,window,document),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(function(){$('[data-toggle="popover"]').popover()}),$(".list-task li label").on("click",function(){$(this).toggleClass("task-done")}),$(".settings_box a").on("click",function(){$("ul.theme_color").toggleClass("theme_block")}),$(".collapseble").on("click",function(){$(".collapseblebox").fadeToggle(350)}),$(".slimscrollright").slimScroll({height:"100%",position:"right",size:"5px",color:"#dcdcdc"}),$(".slimscrollsidebar").slimScroll({height:"100%",position:"right",size:"5px",color:"#dcdcdc"}),$(".chat-list").slimScroll({height:"100%",position:"right",size:"5px",color:"#dcdcdc"}),e.trigger("resize"),$(".visited li a").on("click",function(e){$(".visited li").removeClass("active");var i=$(this).parent();i.hasClass("active")||i.addClass("active"),e.preventDefault()}),$("#to-recover").on("click",function(){$("#loginform").slideUp(),$("#recoverform").fadeIn()}),$(".navbar-toggle").on("click",function(){$(".navbar-toggle i").toggleClass("ti-menu").addClass("ti-close")})});


var showSnackBar = function (data) {
    var x = (data.code == 200)?'success':'error';
    $('#snackbar')
        .html(data.text)
        .addClass('show ' + x);
    setTimeout(function(){$('#snackbar').removeClass('show ' + x);},3000)
}


$('.fiyat_format').priceFormat({
    clearPrefix: true,
    centsSeparator: '.',
    thousandsSeparator: ''
});


$('.js-multi-select:not(.js-select-centered)').multiSelect();

$('.js-multi-select.js-select-centered').multiSelect({
    'cssClass' : 'mx-auto'
});

$('.js-change-yetki').on('change',function(){
    if($(this).val() == 'user'){
        $(this).parent().parent().next().show();
    } else {
        $(this).parent().parent().next().hide();
    }
});



// Switchery
var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));
$('.js-switch').each(function() {
    new Switchery($(this)[0], $(this).data());
});

$('#davet_sahibi_tel').on()


function formValidCheck(){
    $('.taksitOdemeInputs input').each(function(x,y){
        console.log($(y).val().length)
        if( $(y).val().length == 0 ){ return 2;}
    });
    return 1;
}


$('body').on('change','.js-auto-calc div:not(:last-child)>input, .js-auto-calc label>input[type="checkbox"]',function(){
    var p = parseFloat($(this).data('price'));
    var c =  $(this).parent().parent().children().length;
    var v = (c > 2) ? parseFloat($('#odeme_yaklasik_kisi_sayisi').val()) : parseFloat($(this).val()) ;
    if($(this).is(':checked')){
        $(this).parent().parent().children('div.d-none').find('input').val(v);
        $(this).parent().parent().children('div:last-child').find('input[type="text"]').val((p * v).toFixed(2) + ' TL');
    } else {
        $(this).parent().parent().children('div.d-none').find('input').val('');
        $(this).parent().parent().children('div:last-child').find('input[type="text"]').val('');
    }
});


var tmp_json = null;

$('body').on('keyup','#validation #odeme_taksit_sayisi, #validation #odeme_alinan_pesinat', function(){
    var ts = parseFloat($('#odeme_taksit_sayisi').val());
    var ap = parseFloat($('#odeme_alinan_pesinat').val());
    var t = parseFloat($('#odeme_toplam').val().replace('.',''));

    if(ap > t) {
        $('#odeme_alinan_pesinat').val(t);
        $('#validation .taksitOzet').html('');
    } else if(!(!$('#odeme_taksit_sayisi').val()) && ts !== 0) {
        if(!(!$('#odeme_alinan_pesinat').val())){
            t = t - ap;
        }
        var x = '<ul class="common-list">';
        x += '<li><a><b>Taksitli fiyatı</b> ' + ts + ' x ' + ( t / ts).toFixed(2) + ' TL' + '</a></li>';
        x += '</ul>';
        $('#validation .taksitOzet').html(x);
        if($('.taksitOdemeInputs').html() === ''){
            $('.taksitOdemeInputs').html(generateTaksitInput(ts));
        } else {
            tmp_json = (tmp_json === null) ? JSON.parse($('.taksitOdemeInputs span').html()) : tmp_json ;
            $('.taksitOdemeInputs').html(generateTaksitInput(ts,tmp_json));
        }
        generateDateInput();
    } else {
        $('#validation .taksitOzet').html('');
    }
});


var generateTaksitInput = function(ts,myJson){
    var tmp = '<div class="form-group"><label for="odeme_tarihleri_{{i}}" class="control-label">{{i}}. Taksit Ödeme Tarihi</label><input type="text" name="odeme_tarihleri[{{id}}]" id="odeme_tarihleri_{{i}}" value="{{v}}" required class="form-control date" readonly></div>';
    var r = '';
    var tmp_v = '';
    var id;
    for (var i = 0; ts > i; i++){
        if($.type(myJson) === "array" && myJson.length > 0 && $.type(myJson[i]) === 'object'){
            tmp_v = myJson[i].donem;
            id = myJson[i].id;
        } else {
            id = 'y_' + i;
            tmp_v = '';
        }
        r += tmp
            .replace(/{{i}}/g, (i + 1 ))
            .replace(/{{v}}/g, tmp_v)
            .replace(/{{id}}/g, id);
    }
    return r;
};

$('body').on('keyup','#validation #odeme_yaklasik_kisi_sayisi', function(){
    if(!(!$(this).val()) && $(this).val() != '0'){
        var x = '<ul class="common-list">';
        var f = (parseFloat($('#odeme_toplam').val().replace('.','')) / parseFloat($(this).val())).toFixed(2);
        x += '<li><a><b>Kişi Başı Ücret</b> ' + f + ' TL' + '</a></li>';
        x += '</ul>';
        $('#validation .kisibasiFiyat').html(x);
        $('#validation [name="odeme_kisi_basi_fiyat"]').val(f);
    } else if (parseInt($(this).val()) === 0) {
        $('#validation [name="odeme_kisi_basi_fiyat"]').val(1);
    } else {
        $('#validation [name="odeme_kisi_basi_fiyat"]').val('');
        $('#validation .kisibasiFiyat').html('');
    }
});


$('body').on('change','#hizmet_salon',function(){
    id = parseInt($(this).val());
    //$('#salonFiyat').html($(this).find('option:selected').data('price') + ' TL');
    $.ajax({
        url: 'api/getReserveDates',
        method: 'POST',
        data: {id:id},
        success: function(x){
            var rd = [];
            $.each(x.data,function(x,y){
                rd.push(y.t);
            });

            $('.gorusme_date').datepicker('destroy');
            $('.gorusme_date').datepicker({
                format: "dd/mm/yyyy",
                weekStart: 1,
                startView: 1,
                daysOfWeekDisabled: "0",
                language: "tr",
                autoclose: true,
                datesDisabled: rd
            });
        }
    })
});

var generateDateInput = function(){
    $('.date').datepicker('destroy');
    $('.date').datepicker({
        format: "dd/mm/yyyy",
        weekStart: 1,
        startView: 1,
        daysOfWeekDisabled: "0",
        language: "tr",
        autoclose: true
    });
};
generateDateInput();

$('.clockpicker').clockpicker({
    donetext: 'Done',
}).find('input').change(function() {
    console.log(this.value);
});




$('#gorusmelistele').DataTable({
    "language": {
        "sProcessing":   "İşleniyor...",
        "sLengthMenu":   "Sayfada _MENU_ Kayıt Göster",
        "sZeroRecords":  "Eşleşen Kayıt Bulunmadı",
        "sInfo":         "  _TOTAL_ Kayıttan _START_ - _END_ Arası Kayıtlar",
        "sInfoEmpty":    "Kayıt Yok",
        "sInfoFiltered": "( _MAX_ Kayıt İçerisinden Bulunan)",
        "sInfoPostFix":  "",
        "sSearch":       "Bul:",
        "sUrl":          "",
        "oPaginate": {
            "sFirst":    "İlk",
            "sPrevious": "Önceki",
            "sNext":     "Sonraki",
            "sLast":     "Son"
        }
    }
    ,
    "fnDrawCallback":function(){
        if ( $('#gorusmelistele_paginate span span.paginate_button').size()) {
            $('#gorusmelistele_paginate')[0].style.display = "block";
        } else {
            $('#gorusmelistele_paginate')[0].style.display = "none";
        }
    },
    "lengthMenu": [ 50, 75, 100, 150, 200 ],
    dom: 'Bfrtip',
    buttons: [
        'excel', 'pdf'
    ]
});



(function() {
    [].slice.call(document.querySelectorAll('.sttabs')).forEach(function(el) {
        new CBPFWTabs(el);
    });
})();


var getNtPdf = function(name) {
    $('body').css({'fontSize':38,'color':'black'});
    $('#sozlesme').css({'fontSize':32,'fontWeight':'400'});
    $('.b-all').css({'borderColor':'black','borderWidth':'4px'});
    $('.b-t').css({'borderColor':'black','borderTopWidth':'4px'});
    $('.b-b').css({'borderColor':'black','borderBottomWidth':'4px'});
    $('h1').css({'fontSize':90,'lineHeight':'110px','marginBottom':70});
    $('h3').css({'fontSize':63,'lineHeight':'90px'});
    $('h4').css({'fontSize':54,'lineHeight':'66px'});
    $('.evrakNo').css({'width':99});
    $('.bw_logo').css({'width':'auto'});
    $('#exportPdfContent').css({"width": 2480,"maxWidth":2480,"minWidth":2480,"height": 3508,"maxHeight":3508,"minHeight":3508,"paddingBottom":0});
    var newWin=window.open('','Print-Window');
    if(name == undefined || name == null || name == '') name = 'harmony';
    html2canvas(document.querySelector("#exportPdfContent")).then(canvas => {
        var data = canvas.toDataURL();
        console.log(data);
        var docDefinition = {
            content: [{
                image: data,
                width: 500,
            }]
        };
        //pdfMake.createPdf(docDefinition).download(name + '.pdf');

        newWin.document.open();
        newWin.document.write('<html style="margin: 0;padding: 0;border: 0;"><head><style>@page {margin: 1%;}</style></head><body style="margin: 0;padding: 0;border: 0;" onload="window.print();"><img style="max-width: 100%" src="'+data +'" /></body></html>');
        newWin.document.close();
        setTimeout(function(){newWin.close();},10);
        $('#exportPdfContent').css({"width": '',"maxWidth":'',"minWidth":'',"height": '',"maxHeight":'',"minHeight":'',"paddingBottom":''});
        $('body').css('fontSize','');
        $('#sozlesme').css({'fontSize':'','fontWeight':''});
        $('.b-all').css({'borderColor':'','borderWidth':''});
        $('.b-t').css({'borderColor':'','borderTopWidth':''});
        $('.b-b').css({'borderColor':'','borderBottomWidth':''});
        $('h1').css({'fontSize':'','flineHeight':''});
        $('h3').css({'fontSize':'','lineHeightt':''});
        $('h4').css({'fontSize':'','lineHeightt':''});
        $('.evrakNo').css({'width':''});
        $('.bw_logo').css({'width':168});
    });
}

$('.textarea_editor').wysihtml5();

var GoldNumber1 = $('.extraList>.item').length;
var GoldNumber2 = Math.floor(GoldNumber1 - (GoldNumber1 - 12) / 2) ;
$('.extraList>.item:nth-child(n + ' + GoldNumber2 + ')').prependTo('.extraListRight')


function humanizeNumber(nStr) {
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + ',' + '$2');
    }
    return x1 + x2;
}

var taksitOde = function(id){
    var myDiv = $('#ode' + id + ' .modal-dialog');
    if($.type(id) === 'number'){
        myDiv.block({message: '<h3>Lütfen Bekleyiniz.</h3>', css: {border: '1px solid #fff'}});

        var aylik = myDiv.find('input').data('price');
        $.ajax({
            method: 'POST',
            url: 'api/taksitOde',
            data: {"aylik": aylik.toFixed(2),"id": id},
            success: function(x) {
                myDiv.unblock();
                if(x === 1){
                    myDiv
                        .parent()
                        .modal('hide')
                        .parent()
                        .parent()
                        .remove()
                    ;
                }
            }
        });
    } else {
        return false;
    }
}